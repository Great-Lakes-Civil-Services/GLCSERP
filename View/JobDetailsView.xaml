<UserControl x:Class="CivilProcessERP.Views.JobDetailsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             Background="LightCyan">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Orientation="Horizontal" Grid.Row="0" Background="White" Margin="10">
            <TextBlock Text="Great Lakes Civil Services" FontSize="22" FontWeight="Bold" Foreground="Blue"/>
            <TextBlock Text=" > Job #" FontSize="16" Margin="10,0"/>
            <TextBlock Text="{Binding Job.JobId}" FontSize="16" FontWeight="Bold"/>
        </StackPanel>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="4*"/>
                <ColumnDefinition Width="3*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Column -->
            <StackPanel Grid.Column="0" Background="LightCyan" Margin="10">
                  <!-- Relationships -->
                <TextBlock Text="Relationships" FontWeight="Bold" Margin="5"/>
                <TextBlock Text="ðŸ”º 3 Other jobs with same Case#" FontStyle="Italic" Foreground="DarkRed" Margin="10,0,5,10"/>

                <TextBlock Text="Court" FontWeight="Bold" Margin="5"/>
                <TextBox Text="{Binding Job.Court}" Margin="5"/>

                <TextBlock Text="Defendant's Name" FontWeight="Bold" Margin="5"/>
                <TextBox Text="{Binding Job.Defendant}" Margin="5"/>

                <TextBlock Text="Servee's Name" FontWeight="Bold" Margin="5"/>
                <TextBox Text="{Binding Job.Plaintiff}" Margin="5"/>

                <TextBlock Text="Servee's Address" FontWeight="Bold" Margin="5"/>
                <TextBox Text="{Binding Job.Address}" Margin="5"/>

                <!-- Zone & SQL -->
        <Grid Grid.Row="1" Margin="5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Margin="2">
                <TextBlock Text="Area" FontWeight="Bold"/>
                <TextBox Text="{Binding Job.Zone}" />
            </StackPanel>

            <StackPanel Grid.Column="1" Margin="2">
                <TextBlock Text="SQL DateTime Created" FontWeight="Bold"/>
                <TextBox Text="{Binding Job.SqlDateTimeCreated}" />
            </StackPanel>
        </Grid>

        <!-- Expiration + Last Day -->
        <Grid Grid.Row="2" Margin="5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Margin="2">
                <TextBlock Text="Expiration Date" FontWeight="Bold"/>
                <TextBox Text="{Binding Job.ExpirationDate}" />
            </StackPanel>

            <StackPanel Grid.Column="1" Margin="2">
                <TextBlock Text="Last Day to Serve Date" FontWeight="Bold"/>
                <TextBox Text="{Binding Job.LastDayToServe}" />
            </StackPanel>
        </Grid>

               <TextBlock Text="Attachments" FontWeight="Bold" Margin="5"/>
    <ListView x:Name="AttachmentsListView"
              ItemsSource="{Binding Job.Attachments}"
              MouseDoubleClick="AttachmentsListView_MouseDoubleClick"
              Margin="5"
              Height="100">
        <ListView.View>
            <GridView>
                <GridViewColumn Header="Purpose" DisplayMemberBinding="{Binding Purpose}" />
                <GridViewColumn Header="Format" DisplayMemberBinding="{Binding Format}" />
                <GridViewColumn Header="Description" DisplayMemberBinding="{Binding Description}" />
                <GridViewColumn Header="Status" DisplayMemberBinding="{Binding Status}" />
            </GridView>
        </ListView.View>
    </ListView>

             
                <StackPanel Orientation="Horizontal" Margin="5">
    <Button Content="Add Attachment" Width="120" Margin="5"
            Click="AddAttachment_Click"/>
    <Button Content="Edit" Width="80" Margin="5"
            Click="EditAttachment_Click"/>
    <Button Content="Delete" Width="80" Margin="5"
            Click="DeleteAttachment_Click"/>
</StackPanel>

<!-- Mailings and Affidavit Buttons using Grid for full width -->
<Grid Margin="5">
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="*" />
    </Grid.ColumnDefinitions>

    <Button Grid.Column="0"
            Content="MAILINGS"
            Height="30"
            Margin="5"
            Background="White"
            BorderBrush="Black"
            FontWeight="Bold"/>

    <Button Grid.Column="1"
            Content="AFFIDAVIT"
            Height="30"
            Margin="5"
            Background="White"
            BorderBrush="Black"
            FontWeight="Bold"/>
</Grid>


                <!-- Workflow Status --> 
                <TextBlock Text="Workflow Status" FontWeight="Bold" Margin="5"/>
                <CheckBox Content="FCM â€“ Needs First-class Mailing sent out" Margin="10,0"/>
                <CheckBox Content="SOPS â€“ Needs to be Sent Out to Process Server" Margin="10,0"/>
                <CheckBox Content="IIA â€“ Needs Invoice Items Added" Margin="10,0"/>
            </StackPanel>

          <Grid Grid.Column="1" Margin="10">
    <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/> <!-- Writ Info -->
        <RowDefinition Height="Auto"/> <!-- Comments -->
        <RowDefinition Height="Auto"/> <!-- Attempts -->
        <RowDefinition Height="*"/>    <!-- Change History expands as needed -->
    </Grid.RowDefinitions>

    <!-- Writ Info -->
    <StackPanel Grid.Row="0">
        <TextBlock Text="Type of Writ" FontWeight="Bold" FontSize="18" Margin="5" TextAlignment="Center"/>
        <TextBox Text="{Binding Job.TypeOfWrit}" Margin="5"/>

        <TextBlock Text="Court Date and Time" FontWeight="Bold" Margin="5"/>
        <StackPanel Orientation="Horizontal" Margin="5">
            <TextBlock Text="Date:" Margin="5"/>
            <TextBox Text="{Binding Job.Date}" Width="120" Margin="5"/>
            <TextBlock Text="Time:" Margin="5"/>
            <TextBox Text="{Binding Job.Time}" Width="120" Margin="5"/>
        </StackPanel>

        <TextBlock Text="Service Information" FontWeight="Bold" Margin="5"/>

<StackPanel Orientation="Horizontal" Margin="5">
    <!-- Service Type -->
    <TextBox Text="{Binding Job.ServiceType}" Width="180" Margin="0,0,10,0"/>

    <!-- Date -->
    <TextBlock Text="Date:" VerticalAlignment="Center" Margin="0,0,5,0"/>
    <TextBox Text="{Binding Job.ServiceDate}" Width="120" Margin="0,0,10,0"/>

    <!-- Time -->
    <TextBlock Text="Time:" VerticalAlignment="Center" Margin="0,0,5,0"/>
    <TextBox Text="{Binding Job.ServiceTime}" Width="120"/>
</StackPanel>
    </StackPanel>

    <!-- Comments -->
    <StackPanel Grid.Row="1">
        <TextBlock Text="Comments" FontWeight="Bold" Margin="5"/>
   <ListView x:Name="CommentsListView" ItemsSource="{Binding Job.Comments}" Height="120" Margin="5"
          ScrollViewer.HorizontalScrollBarVisibility="Disabled">
    <ListView.View>
        <GridView>
            <!-- DATE (only date part shown) -->
            <GridViewColumn Header="DATE" Width="100">
                <GridViewColumn.CellTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding Date, StringFormat={}{0:MM/dd/yyyy}}"/>
                    </DataTemplate>
                </GridViewColumn.CellTemplate>
            </GridViewColumn>

            <!-- TIME (only time part shown) -->
            <GridViewColumn Header="TIME" Width="80">
                <GridViewColumn.CellTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding Date, StringFormat={}{0:h:mm tt}}"/>
                    </DataTemplate>
                </GridViewColumn.CellTemplate>
            </GridViewColumn>

            <!-- BODY (give this most space) -->
            <GridViewColumn Header="BODY" DisplayMemberBinding="{Binding Body}" Width="250"/>

            <!-- AFF Checkbox -->
            <GridViewColumn Header="AFF" Width="40">
                <GridViewColumn.CellTemplate>
                    <DataTemplate>
                        <CheckBox IsChecked="{Binding Aff}" IsEnabled="False" HorizontalAlignment="Center"/>
                    </DataTemplate>
                </GridViewColumn.CellTemplate>
            </GridViewColumn>

            <!-- DS Checkbox -->
            <GridViewColumn Header="DS" Width="40">
                <GridViewColumn.CellTemplate>
                    <DataTemplate>
                        <CheckBox IsChecked="{Binding FS}" IsEnabled="False" HorizontalAlignment="Center"/>
                    </DataTemplate>
                </GridViewColumn.CellTemplate>
            </GridViewColumn>

            <!-- ATT Checkbox -->
            <GridViewColumn Header="ATT" Width="40">
                <GridViewColumn.CellTemplate>
                    <DataTemplate>
                        <CheckBox IsChecked="{Binding Att}" IsEnabled="False" HorizontalAlignment="Center"/>
                    </DataTemplate>
                </GridViewColumn.CellTemplate>
            </GridViewColumn>

            <!-- SOURCE -->
            <GridViewColumn Header="SOURCE" DisplayMemberBinding="{Binding Source}" Width="100"/>
        </GridView>
    </ListView.View>
    </ListView>


        <StackPanel Orientation="Horizontal" Margin="5">
            <Button Content="Add Comment" Click="AddComment_Click" Margin="5"/>
            <Button Content="Edit Comment" Click="EditComment_Click" Margin="5"/>
            <Button Content="Delete Comment" Click="DeleteComment_Click" Margin="5"/>
        </StackPanel>
</StackPanel>

    <!-- Attempts -->
    <StackPanel Grid.Row="2">
        <TextBlock Text="Attempts" FontWeight="Bold" Margin="5"/>
        <ListView x:Name="AttemptsListView" ItemsSource="{Binding AttemptEntries}" Height="120" Margin="5"
          ScrollViewer.HorizontalScrollBarVisibility="Disabled">
    <ListView.View>
        <GridView>
            <!-- DATE only -->
            <GridViewColumn Header="DATE" Width="100">
                <GridViewColumn.CellTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding Date, StringFormat={}{0:MM/dd/yyyy}}"/>
                    </DataTemplate>
                </GridViewColumn.CellTemplate>
            </GridViewColumn>

            <!-- TIME only -->
            <GridViewColumn Header="TIME" Width="80">
                <GridViewColumn.CellTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding Date, StringFormat={}{0:h:mm tt}}"/>
                    </DataTemplate>
                </GridViewColumn.CellTemplate>
            </GridViewColumn>

            <!-- BODY with ellipsis -->
            <GridViewColumn Header="BODY" Width="250">
                <GridViewColumn.CellTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding Body}" TextTrimming="CharacterEllipsis"/>
                    </DataTemplate>
                </GridViewColumn.CellTemplate>
            </GridViewColumn>

            <!-- AFF Checkbox -->
            <GridViewColumn Header="AFF" Width="40">
                <GridViewColumn.CellTemplate>
                    <DataTemplate>
                        <CheckBox IsChecked="{Binding Aff}" IsEnabled="False" HorizontalAlignment="Center"/>
                    </DataTemplate>
                </GridViewColumn.CellTemplate>
            </GridViewColumn>

            <!-- DS Checkbox -->
            <GridViewColumn Header="DS" Width="40">
                <GridViewColumn.CellTemplate>
                    <DataTemplate>
                        <CheckBox IsChecked="{Binding FS}" IsEnabled="False" HorizontalAlignment="Center"/>
                    </DataTemplate>
                </GridViewColumn.CellTemplate>
            </GridViewColumn>

            <!-- ATT Checkbox -->
            <GridViewColumn Header="ATT" Width="40">
                <GridViewColumn.CellTemplate>
                    <DataTemplate>
                        <CheckBox IsChecked="{Binding Att}" IsEnabled="False" HorizontalAlignment="Center"/>
                    </DataTemplate>
                </GridViewColumn.CellTemplate>
            </GridViewColumn>

            <!-- SOURCE -->
            <GridViewColumn Header="SOURCE" Width="100" DisplayMemberBinding="{Binding Source}" />
        </GridView>
    </ListView.View>
</ListView>

        <StackPanel Orientation="Horizontal" Margin="5">
            <Button Content="Add Attempt" Click="AddAttempt_Click" Margin="5"/>
            <Button Content="Edit Attempt" Click="EditAttempt_Click" Margin="5"/>
            <Button Content="Delete Attempt" Click="DeleteAttempt_Click" Margin="5"/>
        </StackPanel>
    </StackPanel>

    <!-- âœ… Change History FIX -->
    
<StackPanel Grid.Row="3" Margin="0,10,0,0">
    <TextBlock Text="Change History" FontWeight="Bold" Margin="5"/>
    <Border BorderBrush="Gray" BorderThickness="1" CornerRadius="4" Margin="5">
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" Height="100">
            <ListView ItemsSource="{Binding Job.ChangeHistory}" Background="White" ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                <ListView.View>
                    <GridView>
                        <!-- FIXED DATE FORMAT -->
                        <GridViewColumn Header="DATE" Width="160">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Date, StringFormat={}{0:MM/dd/yyyy}}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <GridViewColumn Header="FIELD" DisplayMemberBinding="{Binding FieldName}" Width="150"/>
                        <GridViewColumn Header="OLD VALUE" DisplayMemberBinding="{Binding OldValue}" Width="150"/>
                        <GridViewColumn Header="NEW VALUE" DisplayMemberBinding="{Binding NewValue}" Width="150"/>
                        <GridViewColumn Header="CHANGED BY" DisplayMemberBinding="{Binding ChangedBy}" Width="150"/>
                    </GridView>
                </ListView.View>
            </ListView>
        </ScrollViewer>
    </Border>
</StackPanel>

<!-- Footer Buttons (Corrected - Aligned under Change History in middle column with downward offset) -->
<Grid Grid.Column="1" Grid.Row="4" Margin="0,150,0,0"> <!-- Top margin to push it downward -->
    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
        <Button Content="Save" Width="120" Height="40" Background="Green" Foreground="White" Margin="10"/>
        <Button Content="Cancel" Width="120" Height="40" Background="Red" Foreground="White" Margin="10"
                Click="CloseButton_Click"/>
    </StackPanel>
</Grid>



</Grid>

<!-- Right Column -->
<ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto" Margin="10" Background="LightCyan">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Top content -->
            <RowDefinition Height="Auto"/> <!-- Invoice -->
            <RowDefinition Height="Auto"/> <!-- Payments -->
            <RowDefinition Height="Auto"/> <!-- Zone & SQL -->
            <RowDefinition Height="Auto"/> <!-- Expiration -->
        </Grid.RowDefinitions>

        <!-- Top Content -->
        <StackPanel Grid.Row="0">
           <Grid Margin="5">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- Case # -->
        <StackPanel Grid.Column="0" Margin="0,0,5,0">
            <TextBlock Text="Case #" FontWeight="Bold" Margin="0,0,0,3"/>
            <TextBox Text="{Binding Job.CaseNumber}" />
        </StackPanel>

        <!-- Client Ref # -->
        <StackPanel Grid.Column="1" Margin="5,0,0,0">
            <TextBlock Text="Client Ref #" FontWeight="Bold" Margin="0,0,0,3"/>
            <TextBox Text="{Binding Job.ClientReference}" />
        </StackPanel>
    </Grid>
            <TextBlock Text="Plaintiff" FontWeight="Bold" Margin="5"/>
            <TextBox Text="{Binding Job.Plaintiff}" Margin="5"/>

            <TextBlock Text="Attorney Name" FontWeight="Bold" Margin="5"/>
            <TextBox Text="{Binding Job.Plaintiff}" Margin="5"/>

            <TextBlock Text="Client" FontWeight="Bold" Margin="5"/>
            <TextBox Text="{Binding Job.Client}" Margin="5" AcceptsReturn="True" Height="10"/>

            <Grid Margin="5">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Margin="2">
                    <TextBlock Text="Process Server" FontWeight="Bold"/>
                    <TextBox Text="{Binding Job.ProcessServer}" />
                </StackPanel>

                <StackPanel Grid.Column="1" Margin="2">
                    <TextBlock Text="Client Status" FontWeight="Bold"/>
                    <TextBox Text="{Binding Job.ClientStatus}" />
                </StackPanel>
            </Grid>
        </StackPanel>

<StackPanel Grid.Row="3">
    <TextBlock Text="Invoice" FontWeight="Bold" Margin="5"/>
    <Border BorderBrush="Black" BorderThickness="1" Margin="5">
        <StackPanel>
            <ListView x:Name="InvoiceListView" ItemsSource="{Binding InvoiceEntries}" Height="100">
                <ListView.View>
                    <GridView>
                        <GridViewColumn Header="Description" DisplayMemberBinding="{Binding Description}" Width="230"/>
                        <GridViewColumn Header="Qty" DisplayMemberBinding="{Binding Quantity}" Width="50"/>
                        <GridViewColumn Header="Rate" DisplayMemberBinding="{Binding Rate}" Width="70"/>
                        <GridViewColumn Header="Amount" DisplayMemberBinding="{Binding Amount}" Width="80"/>
                    </GridView>
                </ListView.View>
            </ListView>

            <!-- Total Invoice Amount aligned with Amount column -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,5,5">
                <TextBlock Text="Total INVOICED:" FontWeight="Bold" VerticalAlignment="Center"/>
                <TextBlock Text="{Binding TotalInvoiceAmount, StringFormat={}{0:C}}"
                           FontWeight="Bold" Margin="5,0,0,0" VerticalAlignment="Center"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="5">
                <Button Content="Add" Width="60" Margin="2" Click="AddInvoice_Click"/>
                <Button Content="Edit" Width="60" Margin="2" Click="EditInvoice_Click"/>
                <Button Content="Delete" Width="60" Margin="2" Click="DeleteInvoice_Click"/>
            </StackPanel>
        </StackPanel>
    </Border>
</StackPanel>


<StackPanel Grid.Row="4">
    <TextBlock Text="Payments" FontWeight="Bold" Margin="5"/>
    <Border BorderBrush="Black" BorderThickness="1" Margin="5">
        <StackPanel>
            <ListView x:Name="PaymentsListView" ItemsSource="{Binding PaymentEntries}" Height="100">
                <ListView.View>
                    <GridView>
                        <GridViewColumn Header="DATE" Width="80">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Date, StringFormat='{}{0:MM/dd/yyyy}'}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="Time">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding TimeOnly}" />
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="Method" DisplayMemberBinding="{Binding Method}" Width="100"/>
                        <GridViewColumn Header="Description" DisplayMemberBinding="{Binding Description}" Width="130"/>
                        <GridViewColumn Header="Amount" DisplayMemberBinding="{Binding Amount}" Width="60"/>
                    </GridView>
                </ListView.View>
            </ListView>

            <!-- Total Payment Amount aligned with Amount column -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,5,5">
                <TextBlock Text="Total PMTS:" FontWeight="Bold" VerticalAlignment="Center"/>
                <TextBlock Text="{Binding TotalPaymentsAmount, StringFormat={}{0:C}}"
                           FontWeight="Bold" Margin="5,0,0,0" VerticalAlignment="Center"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="5">
                <Button Content="Add" Width="60" Margin="2" Click="AddPayment_Click"/>
                <Button Content="Edit" Width="60" Margin="2" Click="EditPayment_Click"/>
                <Button Content="Delete" Width="60" Margin="2" Click="DeletePayment_Click"/>
            </StackPanel>
        </StackPanel>
    </Border>
</StackPanel>


        <!-- Invoice Due -->
<StackPanel Grid.Row="5" Margin="5">
    <TextBlock Text="Invoice Due" FontWeight="Bold" Margin="0,200,0,3"/>
    <TextBox Text="{Binding Job.InvoiceDue}" Width="200"/>
</StackPanel>

    </Grid>
</ScrollViewer>
    </Grid>
    </Grid>
</UserControl>
